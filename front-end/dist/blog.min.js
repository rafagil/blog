angular.module("rafaelgil.blog",["ui.router","rafaelgil.blog.services"]).config(["$httpProvider","$stateProvider","$locationProvider","$urlRouterProvider",function(e,t,n,o){"use strict";var i=window.navigator.userAgent,a=i.indexOf("MSIE ")>=0;n.html5Mode(!a),t.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("posts",{url:"/",templateUrl:"views/posts.html",controller:"PostsController"}).state("post-view",{url:"/:url",params:{post:null},templateUrl:"views/post.html",controller:"PostController"}),o.otherwise("/")}]),function(e){skel.breakpoints({xlarge:"(max-width: 1680px)",large:"(max-width: 1280px)",medium:"(max-width: 980px)",small:"(max-width: 736px)",xsmall:"(max-width: 480px)"}),e(function(){var t=e(window),n=e("body"),o=e("#menu"),i=e("#sidebar"),a=e("#main");n.addClass("is-loading"),t.on("load",function(){window.setTimeout(function(){n.removeClass("is-loading")},100)}),e("form").placeholder(),skel.on("+medium -medium",function(){e.prioritize(".important\\28 medium\\29",skel.breakpoint("medium").active)}),skel.vars.IEVersion<=9&&a.insertAfter(i),o.appendTo(n).panel({delay:500,hideOnClick:!0,hideOnSwipe:!0,resetScroll:!0,resetForms:!0,side:"right",target:n,visibleClass:"is-menu-visible"});var r=e("#search"),l=r.find("input");n.on("click",'[href="#search"]',function(e){e.preventDefault(),r.hasClass("visible")||(r[0].reset(),r.addClass("visible"),l.focus())}),l.on("keydown",function(e){27==e.keyCode&&l.blur()}).on("blur",function(){window.setTimeout(function(){r.removeClass("visible")},100)});var s=e("#intro");skel.on("+large",function(){s.prependTo(a)}).on("-large",function(){s.prependTo(i)})})}(jQuery),function(e){e.fn.navList=function(){var t=e(this);return $a=t.find("a"),b=[],$a.each(function(){var t=e(this),n=Math.max(0,t.parents("li").length-1),o=t.attr("href"),i=t.attr("target");b.push('<a class="link depth-'+n+'"'+("undefined"!=typeof i&&""!=i?' target="'+i+'"':"")+("undefined"!=typeof o&&""!=o?' href="'+o+'"':"")+'><span class="indent-'+n+'"></span>'+t.text()+"</a>")}),b.join("")},e.fn.panel=function(t){if(0==this.length)return i;if(this.length>1){for(var n=0;n<this.length;n++)e(this[n]).panel(t);return i}var o,i=e(this),a=e("body"),r=e(window),l=i.attr("id");return o=e.extend({delay:0,hideOnClick:!1,hideOnEscape:!1,hideOnSwipe:!1,resetScroll:!1,resetForms:!1,side:null,target:i,visibleClass:"visible"},t),"jQuery"!=typeof o.target&&(o.target=e(o.target)),i._hide=function(e){o.target.hasClass(o.visibleClass)&&(e&&(e.preventDefault(),e.stopPropagation()),o.target.removeClass(o.visibleClass),window.setTimeout(function(){o.resetScroll&&i.scrollTop(0),o.resetForms&&i.find("form").each(function(){this.reset()})},o.delay))},i.css("-ms-overflow-style","-ms-autohiding-scrollbar").css("-webkit-overflow-scrolling","touch"),o.hideOnClick&&(i.find("a").css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),i.on("click","a",function(t){var n=e(this),a=n.attr("href"),r=n.attr("target");a&&"#"!=a&&""!=a&&a!="#"+l&&(t.preventDefault(),t.stopPropagation(),i._hide(),window.setTimeout(function(){"_blank"==r?window.open(a):window.location.href=a},o.delay+10))})),i.on("touchstart",function(e){i.touchPosX=e.originalEvent.touches[0].pageX,i.touchPosY=e.originalEvent.touches[0].pageY}),i.on("touchmove",function(e){if(null!==i.touchPosX&&null!==i.touchPosY){var t=i.touchPosX-e.originalEvent.touches[0].pageX,n=i.touchPosY-e.originalEvent.touches[0].pageY,a=i.outerHeight(),r=i.get(0).scrollHeight-i.scrollTop();if(o.hideOnSwipe){var l=!1,s=20,u=50;switch(o.side){case"left":l=s>n&&n>-1*s&&t>u;break;case"right":l=s>n&&n>-1*s&&-1*u>t;break;case"top":l=s>t&&t>-1*s&&n>u;break;case"bottom":l=s>t&&t>-1*s&&-1*u>n}if(l)return i.touchPosX=null,i.touchPosY=null,i._hide(),!1}(i.scrollTop()<0&&0>n||r>a-2&&a+2>r&&n>0)&&(e.preventDefault(),e.stopPropagation())}}),i.on("click touchend touchstart touchmove",function(e){e.stopPropagation()}),i.on("click",'a[href="#'+l+'"]',function(e){e.preventDefault(),e.stopPropagation(),o.target.removeClass(o.visibleClass)}),a.on("click touchend",function(e){i._hide(e)}),a.on("click",'a[href="#'+l+'"]',function(e){e.preventDefault(),e.stopPropagation(),o.target.toggleClass(o.visibleClass)}),o.hideOnEscape&&r.on("keydown",function(e){27==e.keyCode&&i._hide(e)}),i},e.fn.placeholder=function(){if("undefined"!=typeof document.createElement("input").placeholder)return e(this);if(0==this.length)return n;if(this.length>1){for(var t=0;t<this.length;t++)e(this[t]).placeholder();return n}var n=e(this);return n.find("input[type=text],textarea").each(function(){var t=e(this);(""==t.val()||t.val()==t.attr("placeholder"))&&t.addClass("polyfill-placeholder").val(t.attr("placeholder"))}).on("blur",function(){var t=e(this);t.attr("name").match(/-polyfill-field$/)||""==t.val()&&t.addClass("polyfill-placeholder").val(t.attr("placeholder"))}).on("focus",function(){var t=e(this);t.attr("name").match(/-polyfill-field$/)||t.val()==t.attr("placeholder")&&t.removeClass("polyfill-placeholder").val("")}),n.find("input[type=password]").each(function(){var t=e(this),n=e(e("<div>").append(t.clone()).remove().html().replace(/type="password"/i,'type="text"').replace(/type=password/i,"type=text"));""!=t.attr("id")&&n.attr("id",t.attr("id")+"-polyfill-field"),""!=t.attr("name")&&n.attr("name",t.attr("name")+"-polyfill-field"),n.addClass("polyfill-placeholder").val(n.attr("placeholder")).insertAfter(t),""==t.val()?t.hide():n.hide(),t.on("blur",function(e){e.preventDefault();var n=t.parent().find("input[name="+t.attr("name")+"-polyfill-field]");""==t.val()&&(t.hide(),n.show())}),n.on("focus",function(e){e.preventDefault();var t=n.parent().find("input[name="+n.attr("name").replace("-polyfill-field","")+"]");n.hide(),t.show().focus()}).on("keypress",function(e){e.preventDefault(),n.val("")})}),n.on("submit",function(){n.find("input[type=text],input[type=password],textarea").each(function(t){var n=e(this);n.attr("name").match(/-polyfill-field$/)&&n.attr("name",""),n.val()==n.attr("placeholder")&&(n.removeClass("polyfill-placeholder"),n.val(""))})}).on("reset",function(t){t.preventDefault(),n.find("select").val(e("option:first").val()),n.find("input,textarea").each(function(){var t,n=e(this);switch(n.removeClass("polyfill-placeholder"),this.type){case"submit":case"reset":break;case"password":n.val(n.attr("defaultValue")),t=n.parent().find("input[name="+n.attr("name")+"-polyfill-field]"),""==n.val()?(n.hide(),t.show()):(n.show(),t.hide());break;case"checkbox":case"radio":n.attr("checked",n.attr("defaultValue"));break;case"text":case"textarea":n.val(n.attr("defaultValue")),""==n.val()&&(n.addClass("polyfill-placeholder"),n.val(n.attr("placeholder")));break;default:n.val(n.attr("defaultValue"))}})}),n},e.prioritize=function(t,n){var o="__prioritize";"jQuery"!=typeof t&&(t=e(t)),t.each(function(){var t,i=e(this),a=i.parent();if(0!=a.length)if(i.data(o)){if(n)return;t=i.data(o),i.insertAfter(t),i.removeData(o)}else{if(!n)return;if(t=i.prev(),0==t.length)return;i.prependTo(a),i.data(o,t)}})}}(jQuery),angular.module("rafaelgil.blog").controller("LoginController",["$scope","$state","LoginService",function(e,t,n){"use strict";e.setup=!1,e.user={},e.login=function(){n.login(e.user).then(function(e){t.go("posts")})["catch"](function(e){alert("Invalid User!")})},e.createUser=function(){e.user.password!==e.user.passwordRetype?alert("Both passwords must be the same!"):n.createUser(e.user).then(function(){e.user.username=e.user.email,e.login()})};var o=function(){n.canSetup().then(function(t){e.setup=t})};o()}]),angular.module("rafaelgil.blog").controller("PostController",["$scope","$stateParams","PostsService","EditorFactory",function(e,t,n,o){"use strict";e.post={};var i=function(){t.post?e.post=t.post:n.find(t.url).then(function(t){e.post=t})};e.edit=function(e){e.editor=o.build("#post_"+e.id),e.editing=!0},e.save=function(e){var t=e.editor;delete e.editor,e.content=t.getContent(),n.update(e).then(function(){t.destroy(),e.editing=!1})},i()}]),angular.module("rafaelgil.blog").controller("PostsController",["$scope","$state","PostsService","EditorFactory","LoginService",function(e,t,n,o,i){"use strict";e.posts=[];var a,r,l=function(){n.list().then(function(n){e.posts=n,n.length||i.canSetup().then(function(e){e&&t.go("login")})})};e.create=function(){e.showAdd=!0,a=o.build("#newSummaryEditor"),r=o.build("#newContentEditor")},e.insert=function(){var t={title:e.newTitle,content:r.getContent(),summary:a.getContent()};n.create(t).then(function(){e.init(),e.showAdd=!1,a.destroy(),r.destroy()})},e.edit=function(e){e.editor=o.build("#post_"+e.id),e.editing=!0},e.save=function(e){var t=e.editor;delete e.editor,e.summary=t.getContent(),n.update(e).then(function(){t.destroy(),e.editing=!1})},e.viewPost=function(e){n.find(e.url).then(function(e){t.go("post-view",{post:e,url:e.url})})},e.init=function(){e.summaryPlaceholder="Summary goes here!",e.contentPlaceholder="Content goes here!",e.newTitle="",i.getCurrentUser().then(function(t){e.loggedIn=!!t}),l()},e.init()}]);