!function(){"use strict";function e(e){e.setBaseUrl("/api")}function t(e){return e.withConfig(function(e){e.setFullResponse(!0)})}angular.module("rafaelgil.blog.services",["restangular","ngSanitize"]).config(["RestangularProvider",e]).factory("RestFullResponse",["Restangular",t])}(),function(){"use strict";function e(){var e={};return e.build=function(e){return new Pen({editor:document.querySelector(e),list:["insertimage","blockquote","h2","h3","p","code","insertorderedlist","insertunorderedlist","inserthorizontalrule","indent","outdent","bold","italic","underline","createlink"]})},e}angular.module("rafaelgil.blog.services").factory("EditorFactory",e)}(),function(){"use strict";function e(e,t){var n={currentUser:null};return n.login=function(t){return e.all("login").post(t).then(function(e){n.currentUser=e})},n.canSetup=function(){return e.one("setup").get().then(function(){return!0})},n.createUser=function(t){return e.all("setup").all("users").post(t)},n.getCurrentUser=function(){var r=t.defer();return n.currentUser?r.resolve(n.currentUser):e.all("users").one("current").get().then(function(e){e&&(n.currentUser=e,r.resolve(e))}),r.promise},n}angular.module("rafaelgil.blog.services").factory("LoginService",["Restangular","$q",e])}(),function(){"use strict";function e(e,t){var n={pages:[]};return n.getPages=function(){return n.pages.length?t(function(e){return n.pages}):e.list().then(function(e){return n.pages=e.plain(),n.pages})},n}angular.module("rafaelgil.blog.services").factory("MainService",["PageService","$q",e])}(),function(){"use strict";function e(e,t){var n={},r=function(e){return t.trustAsHtml(e.summary),t.trustAsHtml(e.contents),e};return n.list=function(){return e.all("pages").getList().then(function(e){return e})},n.find=function(t){return e.one("pages").get({url:t}).then(function(e){return r(e)})},n.create=function(t){return e.all("pages").post(t)},n.update=function(e){return e.put()},n}angular.module("rafaelgil.blog.services").factory("PageService",["Restangular","$sce",e])}(),function(){"use strict";function e(e,t,n){var r={},o=function(e){return n.trustAsHtml(e.summary),n.trustAsHtml(e.contents),e};return r.list=function(e){return t.all("posts").getList({},e).then(function(e){var t=e.data;return t.forEach(function(e){o(e)}),{posts:t,totalResults:parseInt(e.headers("totalResults"),10)}})},r.find=function(t){return e.one("posts").get({url:t}).then(function(e){return o(e)})},r.create=function(t){return e.all("posts").post(t)},r.update=function(e){return e.put()},r}angular.module("rafaelgil.blog.services").factory("PostsService",["Restangular","RestFullResponse","$sce",e])}(),function(){"use strict";function e(e,t,n,r){var o=window.navigator.userAgent,i=o.indexOf("MSIE ")>=0;n.html5Mode(!i),t.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController as vm"}).state("main",{"abstract":!0,controller:"MainController as main",templateUrl:"views/main.html"}).state("main.posts",{url:"/",templateUrl:"views/posts.html",controller:"PostsController as vm"}).state("main.post-view",{url:"/:url",params:{post:null},templateUrl:"views/post.html",controller:"PostController as vm"}).state("main.page",{url:"/pages/:url",params:{page:null},templateUrl:"views/page.html",controller:"PageController as vm"}),r.otherwise("/")}angular.module("rafaelgil.blog",["ui.router","rafaelgil.blog.services"]).config(["$httpProvider","$stateProvider","$locationProvider","$urlRouterProvider",e])}(),function(e){e.fn.navList=function(){var t=e(this);return $a=t.find("a"),b=[],$a.each(function(){var t=e(this),n=Math.max(0,t.parents("li").length-1),r=t.attr("href"),o=t.attr("target");b.push('<a class="link depth-'+n+'"'+("undefined"!=typeof o&&""!=o?' target="'+o+'"':"")+("undefined"!=typeof r&&""!=r?' href="'+r+'"':"")+'><span class="indent-'+n+'"></span>'+t.text()+"</a>")}),b.join("")},e.fn.panel=function(t){if(0==this.length)return o;if(this.length>1){for(var n=0;n<this.length;n++)e(this[n]).panel(t);return o}var r,o=e(this),i=e("body"),a=e(window),l=o.attr("id");return r=e.extend({delay:0,hideOnClick:!1,hideOnEscape:!1,hideOnSwipe:!1,resetScroll:!1,resetForms:!1,side:null,target:o,visibleClass:"visible"},t),"jQuery"!=typeof r.target&&(r.target=e(r.target)),o._hide=function(e){r.target.hasClass(r.visibleClass)&&(e&&(e.preventDefault(),e.stopPropagation()),r.target.removeClass(r.visibleClass),window.setTimeout(function(){r.resetScroll&&o.scrollTop(0),r.resetForms&&o.find("form").each(function(){this.reset()})},r.delay))},o.css("-ms-overflow-style","-ms-autohiding-scrollbar").css("-webkit-overflow-scrolling","touch"),r.hideOnClick&&(o.find("a").css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),o.on("click","a",function(t){var n=e(this),i=n.attr("href"),a=n.attr("target");i&&"#"!=i&&""!=i&&i!="#"+l&&(t.preventDefault(),t.stopPropagation(),o._hide(),window.setTimeout(function(){"_blank"==a?window.open(i):window.location.href=i},r.delay+10))})),o.on("touchstart",function(e){o.touchPosX=e.originalEvent.touches[0].pageX,o.touchPosY=e.originalEvent.touches[0].pageY}),o.on("touchmove",function(e){if(null!==o.touchPosX&&null!==o.touchPosY){var t=o.touchPosX-e.originalEvent.touches[0].pageX,n=o.touchPosY-e.originalEvent.touches[0].pageY,i=o.outerHeight(),a=o.get(0).scrollHeight-o.scrollTop();if(r.hideOnSwipe){var l=!1,s=20,u=50;switch(r.side){case"left":l=s>n&&n>-1*s&&t>u;break;case"right":l=s>n&&n>-1*s&&-1*u>t;break;case"top":l=s>t&&t>-1*s&&n>u;break;case"bottom":l=s>t&&t>-1*s&&-1*u>n}if(l)return o.touchPosX=null,o.touchPosY=null,o._hide(),!1}(o.scrollTop()<0&&0>n||a>i-2&&i+2>a&&n>0)&&(e.preventDefault(),e.stopPropagation())}}),o.on("click touchend touchstart touchmove",function(e){e.stopPropagation()}),o.on("click",'a[href="#'+l+'"]',function(e){e.preventDefault(),e.stopPropagation(),r.target.removeClass(r.visibleClass)}),i.on("click touchend",function(e){o._hide(e)}),i.on("click",'a[href="#'+l+'"]',function(e){e.preventDefault(),e.stopPropagation(),r.target.toggleClass(r.visibleClass)}),r.hideOnEscape&&a.on("keydown",function(e){27==e.keyCode&&o._hide(e)}),o},e.fn.placeholder=function(){if("undefined"!=typeof document.createElement("input").placeholder)return e(this);if(0==this.length)return n;if(this.length>1){for(var t=0;t<this.length;t++)e(this[t]).placeholder();return n}var n=e(this);return n.find("input[type=text],textarea").each(function(){var t=e(this);(""==t.val()||t.val()==t.attr("placeholder"))&&t.addClass("polyfill-placeholder").val(t.attr("placeholder"))}).on("blur",function(){var t=e(this);t.attr("name").match(/-polyfill-field$/)||""==t.val()&&t.addClass("polyfill-placeholder").val(t.attr("placeholder"))}).on("focus",function(){var t=e(this);t.attr("name").match(/-polyfill-field$/)||t.val()==t.attr("placeholder")&&t.removeClass("polyfill-placeholder").val("")}),n.find("input[type=password]").each(function(){var t=e(this),n=e(e("<div>").append(t.clone()).remove().html().replace(/type="password"/i,'type="text"').replace(/type=password/i,"type=text"));""!=t.attr("id")&&n.attr("id",t.attr("id")+"-polyfill-field"),""!=t.attr("name")&&n.attr("name",t.attr("name")+"-polyfill-field"),n.addClass("polyfill-placeholder").val(n.attr("placeholder")).insertAfter(t),""==t.val()?t.hide():n.hide(),t.on("blur",function(e){e.preventDefault();var n=t.parent().find("input[name="+t.attr("name")+"-polyfill-field]");""==t.val()&&(t.hide(),n.show())}),n.on("focus",function(e){e.preventDefault();var t=n.parent().find("input[name="+n.attr("name").replace("-polyfill-field","")+"]");n.hide(),t.show().focus()}).on("keypress",function(e){e.preventDefault(),n.val("")})}),n.on("submit",function(){n.find("input[type=text],input[type=password],textarea").each(function(t){var n=e(this);n.attr("name").match(/-polyfill-field$/)&&n.attr("name",""),n.val()==n.attr("placeholder")&&(n.removeClass("polyfill-placeholder"),n.val(""))})}).on("reset",function(t){t.preventDefault(),n.find("select").val(e("option:first").val()),n.find("input,textarea").each(function(){var t,n=e(this);switch(n.removeClass("polyfill-placeholder"),this.type){case"submit":case"reset":break;case"password":n.val(n.attr("defaultValue")),t=n.parent().find("input[name="+n.attr("name")+"-polyfill-field]"),""==n.val()?(n.hide(),t.show()):(n.show(),t.hide());break;case"checkbox":case"radio":n.attr("checked",n.attr("defaultValue"));break;case"text":case"textarea":n.val(n.attr("defaultValue")),""==n.val()&&(n.addClass("polyfill-placeholder"),n.val(n.attr("placeholder")));break;default:n.val(n.attr("defaultValue"))}})}),n},e.prioritize=function(t,n){var r="__prioritize";"jQuery"!=typeof t&&(t=e(t)),t.each(function(){var t,o=e(this),i=o.parent();if(0!=i.length)if(o.data(r)){if(n)return;t=o.data(r),o.insertAfter(t),o.removeData(r)}else{if(!n)return;if(t=o.prev(),0==t.length)return;o.prependTo(i),o.data(r,t)}})}}(jQuery),function(){"use strict";function e(e,t){var n=this;n.setup=!1,n.user={},n.login=function(){t.login(n.user).then(function(t){e.go("posts")})["catch"](function(e){alert("Invalid User!")})},n.createUser=function(){n.user.password!==n.user.passwordRetype?alert("Both passwords must be the same!"):t.createUser(n.user).then(function(){n.user.username=n.user.email,n.login()})};var r=function(){t.canSetup().then(function(e){n.setup=e})};r()}angular.module("rafaelgil.blog").controller("LoginController",["$state","LoginService",e])}(),function(){"use strict";function e(e,t,n){var r=this;r.viewPage=function(e){t.find(e.url).then(function(t){n.go("main.page",{page:t,url:e.url})})},e.getPages().then(function(e){r.pages=e})}angular.module("rafaelgil.blog").controller("MainController",["MainService","PageService","$state",e])}(),function(){"use strict";function e(e,t,n){var r=this;r.page={};var o=function(){e.page?r.page=e.page:t.find(e.url).then(function(e){r.page=e})};r.edit=function(e){e.editor=n.build("#page"),e.editing=!0},r.save=function(e){var n=e.editor;delete e.editor,e.content=n.getContent(),t.update(e).then(function(){n.destroy(),e.editing=!1})},o()}angular.module("rafaelgil.blog").controller("PageController",["$stateParams","PageService","EditorFactory",e])}(),function(){"use strict";function e(e,t,n){var r=this;r.post={};var o=function(){e.post?r.post=e.post:t.find(e.url).then(function(e){r.post=e})};r.edit=function(e){e.editor=n.build("#post_"+e.id),e.editing=!0},r.save=function(e){var n=e.editor;delete e.editor,e.content=n.getContent(),t.update(e).then(function(){n.destroy(),e.editing=!1})},o()}angular.module("rafaelgil.blog").controller("PostController",["$stateParams","PostsService","EditorFactory",e])}(),function(){"use strict";function e(e,t,n,r){var o=this;o.paginationInfo={page:1,pageSize:5},o.canGoBack=!1,o.posts=[],o.currentUser="";var i,a,l=function(){t.list(o.paginationInfo).then(function(t){o.canGoBack=o.paginationInfo.page*o.paginationInfo.pageSize<=t.totalResults,o.posts=t.posts,t.posts.length||r.canSetup().then(function(t){t&&e.go("login")}),window.scrollTo(0,0)})};o.create=function(){o.showAdd=!0,i=n.build("#newSummaryEditor"),a=n.build("#newContentEditor")},o.insert=function(){var e={title:o.newTitle,content:a.getContent(),summary:i.getContent()};t.create(e).then(function(){o.init(),o.showAdd=!1,i.destroy(),a.destroy()})},o.edit=function(e){e.editor=n.build("#post_"+e.id),e.editing=!0},o.save=function(e){var n=e.editor;delete e.editor,e.summary=n.getContent(),t.update(e).then(function(){n.destroy(),e.editing=!1})},o.viewPost=function(n){t.find(n.url).then(function(t){e.go("main.post-view",{post:t,url:t.url})})},o.olderPosts=function(){o.canGoBack&&(o.paginationInfo.page++,l())},o.newerPosts=function(){o.paginationInfo.page>1&&(o.paginationInfo.page--,l())},o.init=function(){o.summaryPlaceholder="Summary goes here!",o.contentPlaceholder="Content goes here!",o.newTitle="",r.getCurrentUser().then(function(e){o.loggedIn=!!e,o.currentUser=e}),l()},o.init()}angular.module("rafaelgil.blog").controller("PostsController",["$state","PostsService","EditorFactory","LoginService",e])}(),function(){function e(){var e=function(){!function(e,t){t.breakpoints({xlarge:"(max-width: 1680px)",large:"(max-width: 1280px)",medium:"(max-width: 980px)",small:"(max-width: 736px)",xsmall:"(max-width: 480px)"}),e(function(){var n=e(window),r=e("body"),o=e("#menu"),i=e("#sidebar"),a=e("#main");r.addClass("is-loading"),n.on("load",function(){window.setTimeout(function(){r.removeClass("is-loading")},100)}),e("form").placeholder(),t.on("+medium -medium",function(){e.prioritize(".important\\28 medium\\29",t.breakpoint("medium").active)}),t.vars.IEVersion<=9&&a.insertAfter(i),o.appendTo(r).panel({delay:500,hideOnClick:!0,hideOnSwipe:!0,resetScroll:!0,resetForms:!0,side:"right",target:r,visibleClass:"is-menu-visible"});var l=e("#search"),s=l.find("input");r.on("click",'[href="#search"]',function(e){e.preventDefault(),l.hasClass("visible")||(l[0].reset(),l.addClass("visible"),s.focus())}),s.on("keydown",function(e){27==e.keyCode&&s.blur()}).on("blur",function(){window.setTimeout(function(){l.removeClass("visible")},100)});var u=e("#intro");t.on("+large",function(){u.prependTo(a)}).on("-large",function(){u.prependTo(i)})})}(jQuery,skel)};return{restrict:"E",link:e}}angular.module("rafaelgil.blog").directive("templateDeps",e)}();